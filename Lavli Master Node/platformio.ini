; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:esp32-s3-devkitc-1]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; Upload settings
upload_speed = 921600
; upload_port = /dev/ttyACM0  ; Adjust for your system (Windows: COMx, macOS: /dev/cu.usbmodemxxx)

; USB settings
board_build.arduino.usb_mode = 1  ; Hardware CDC and JTAG
board_build.arduino.usb_cdc_on_boot = 1  ; USB CDC On Boot enabled

; CPU and Flash settings
board_build.f_cpu = 240000000L  ; 240MHz
board_build.flash_mode = qio
board_build.f_flash = 80000000L  ; 80MHz flash

; Partition scheme (Default 4MB with SPIFFS)
board_build.partitions = default.csv
board_build.flash_size = 4MB

; Core assignments
board_build.arduino_core = 1  ; Arduino runs on Core 1
board_build.arduino_event = 1  ; Events run on Core 1

; Debug level
build_flags = 
    -DCORE_DEBUG_LEVEL=0  ; None

; Monitor settings (optional but helpful)
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

lib_deps =
    https://github.com/espressif/arduino-esp32.git
    adafruit/Adafruit NeoPixel @ ^1.12.0
    madhephaestus/ESP32Encoder @ ^0.10.2
    tzapu/WiFiManager@^2.0.17
    knolleary/PubSubClient@^2.8
    bblanchon/ArduinoJson@^7.0.4
    h2zero/NimBLE-Arduino@^1.4.2

[env:esp32-builds]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; Upload settings
upload_speed = 921600

; USB settings
board_build.arduino.usb_mode = 1
board_build.arduino.usb_cdc_on_boot = 1

; CPU and Flash settings
board_build.f_cpu = 240000000L
board_build.flash_mode = qio
board_build.f_flash = 40000000L
board_build.flash_size = 4MB

; Debug level
build_flags = 
    -DCORE_DEBUG_LEVEL=0

; Monitor settings
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

lib_deps =
    adafruit/Adafruit NeoPixel @ ^1.12.0
    madhephaestus/ESP32Encoder @ ^0.10.2
    tzapu/WiFiManager@^2.0.17
    knolleary/PubSubClient@^2.8
    bblanchon/ArduinoJson@^7.0.4
    h2zero/NimBLE-Arduino@^1.4.2

[env:lavli-master]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; Flash / PSRAM (safe defaults for DevKitC-1; change only if you know your chips)
board_build.flash_mode = qio
board_build.partitions = default.csv
board_build.psram_type = opi

; Some DevKitC-1s have 8MB flash; 4MB works for basics, but if your chip is 8MB:
; board_upload.flash_size = 8MB
; board_upload.maximum_size = 8388608
board_upload.flash_size = 4MB
board_upload.maximum_size = 4194304

board_build.extra_flags =
  -DBOARD_HAS_PSRAM
  -DARDUINO_USB_MODE=1
  -DARDUINO_USB_CDC_ON_BOOT=1

lib_deps =
    ; https://github.com/espressif/arduino-esp32.git
    adafruit/Adafruit NeoPixel @ ^1.12.0
    madhephaestus/ESP32Encoder @ ^0.10.2
    tzapu/WiFiManager@^2.0.17
    knolleary/PubSubClient@^2.8
    bblanchon/ArduinoJson@^7.0.4
    h2zero/NimBLE-Arduino@^1.4.2

; Upload/monitor
; If you rely on USB-CDC, PlatformIO will find the right port after first flash.
; You can pin them explicitly if flaky:
; upload_port = /dev/ttyACM0     ; or COM7 on Windows
; monitor_port = /dev/ttyACM0    ; or COM7 on Windows
monitor_speed = 115200
monitor_filters = esp32_exception_decoder